"use strict";angular.module("textAnalysis",["ngRoute","d3"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"./components/home/home.view.html",controller:"homeCtrl"}).when("/tweets/:handle",{templateUrl:"./components/tweets/tweets.view.html",controller:"tweetCtrl"}).when("/results/:handle/:id",{templateUrl:"./components/results/results.view.html",controller:"resultsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("textAnalysis").factory("twitterService",["$q","$http","$log","$routeParams",function(e,t,n,a){var r={resultsTweet:"",userTimeline:{},checkCache:function(e,t){angular.isDefined(r.userTimeline[e+"-"+t])||(r.userTimeline[e+"-"+t]=[])},loadTweets:function(a,i){r.checkCache(a,i);var s=e.defer();return r.userTimeline[a+"-"+i].length>0?s.resolve(r.userTimeline[a+"-"+i]):t.get("/api/"+a,{params:{timeline:i}}).success(function(e){s.resolve(e),r.userTimeline[a+"-"+i]=e}).error(function(e){n.log("Error: ",e),s.reject(e)}),s.promise},getSingleTweet:function(a){var i=e.defer();return t.get("/api/results/"+a).success(function(e){i.resolve(e),r.resultsTweet=e.text}).error(function(e){n.log("Error: ",e),i.reject(e)}),i.promise}};return r}]),angular.module("textAnalysis").factory("aylienService",["$q","$http","$log","$routeParams",function(e,t,n,a){var r={analysisData:{},checkCache:function(e){angular.isDefined(r.analysisData[e])||(r.analysisData[e]={})},getSentiment:function(i){r.checkCache(a.handle);var s=encodeURIComponent(i),o=e.defer();return angular.isDefined(r.analysisData[a.handle].sentiment)?o.resolve(r.analysisData[a.handle].sentiment):t.get("/api/tweets/sentiment/"+s).success(function(e){o.resolve(e),r.analysisData[a.handle].sentiment=e}).error(function(e){n.log("Error ",e),o.reject(e)}),o.promise},getHashtags:function(i){r.checkCache(a.handle);var s=encodeURIComponent(i),o=e.defer();return angular.isDefined(r.analysisData[a.handle].hashtags)?o.resolve(r.analysisData[a.handle].hashtags):t.get("/api/tweets/hashtags/"+s).success(function(e){o.resolve(e),r.analysisData[a.handle].hashtags=e}).error(function(e){n.log("Error ",e),o.reject(e)}),o.promise},getEntities:function(i){r.checkCache(a.handle);var s=encodeURIComponent(i),o=e.defer();return angular.isDefined(r.analysisData[a.handle].entities)?o.resolve(r.analysisData[a.handle].entities):t.get("/api/tweets/entities/"+s).success(function(e){o.resolve(e),r.analysisData[a.handle].entities=e}).error(function(e){n.log("Error ",e),o.reject(e)}),o.promise},getClasses:function(i){r.checkCache(a.handle);var s=encodeURIComponent(i),o=e.defer();return angular.isDefined(r.analysisData[a.handle].classes)?o.resolve(r.analysisData[a.handle].classes):t.get("/api/tweets/classify/"+s).success(function(e){o.resolve(e),r.analysisData[a.handle].classes=e}).error(function(e){n.log("Error ",e),o.reject(e)}),o.promise},getConcepts:function(i){r.checkCache(a.handle);var s=encodeURIComponent(i),o=e.defer();return angular.isDefined(r.analysisData[a.handle].concepts)?o.resolve(r.analysisData[a.handle].concepts):t.get("/api/tweets/concepts/"+s).success(function(e){o.resolve(e),r.analysisData[a.handle].concepts=e}).error(function(e){n.log("Error ",e),o.reject(e)}),o.promise}};return r}]),angular.module("textAnalysis").directive("wordcloud",["d3",function(e){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(t,n,a){var r,i=1370,s=1e3,o="Roboto",l=100;if(angular.isDefined(a.width)&&(i=a.width),angular.isDefined(a.height)&&(s=a.height),angular.isDefined(a.fontFamily)&&(o=a.fontFamily),angular.isDefined(a.fontSize)&&(l=1*a.fontSize||0),angular.isDefined(t.words)&&(r=t.words),angular.isDefined(t.words)&&angular.isArray(r))r=t.words;else if(angular.element(n).find("word").length>0){var u=angular.element(n).find("word");r=[],angular.forEach(u,function(e){r.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(n.text().length>0))return void n.text("wordcloud: Please define some words");r=n.text().split(","),n.text("")}if(!angular.isNumber(l)||0>=l)return void n.text("wordcloud: font-size attribute not valid. font-size "+a.fontSize+" -> "+l);var c=function(a){function r(a){var r=s/2,l=i/2,c=n[0];e.select(c).append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+l+","+r+")").selectAll("text").data(a).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",o).style("fill",function(e,t){return u(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){t.onClick({element:e})}).on("mouseover",function(e){t.onHover({element:e})})}var u=e.scale.category20();e.layout.cloud().size([i,s]).words(a.map(function(e){return{text:e,size:Math.random()*l}})).rotate(function(){return-90*~~(2*Math.random())}).font(o).fontSize(function(e){return e.size}).on("end",r).start()};c(r)}}}]),angular.module("textAnalysis").directive("resultsCloud",["d3",function(e){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(t,n,a){var r,i=400,s=900,o="Roboto",l=200;if(angular.isDefined(a.width)&&(s=a.width),angular.isDefined(a.height)&&(i=a.height),angular.isDefined(a.fontFamily)&&(o=a.fontFamily),angular.isDefined(a.fontSize)&&(l=1*a.fontSize||0),angular.isDefined(t.words)&&(r=t.words),angular.isDefined(t.words)&&angular.isArray(r))r=t.words;else if(angular.element(n).find("word").length>0){var u=angular.element(n).find("word");r=[],angular.forEach(u,function(e){r.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(n.text().length>0))return void n.text("wordcloud: Please define some words");r=n.text().split(","),n.text("")}if(!angular.isNumber(l)||0>=l)return void n.text("wordcloud: font-size attribute not valid. font-size "+a.fontSize+" -> "+l);var c=function(a){function r(a){var r=i/2,l=s/2,c=n[0];e.select(c).append("svg").attr("width",s).attr("height",i).append("g").attr("transform","translate("+l+","+r+")").selectAll("text").data(a).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",o).style("fill",function(e,t){return u(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){t.onClick({element:e})}).on("mouseover",function(e){t.onHover({element:e})})}var u=e.scale.category20();e.layout.cloud().size([s,i]).words(a.map(function(e){return{text:e,size:Math.random()*l}})).rotate(function(){return-90*~~(2*Math.random())}).font(o).fontSize(function(e){return e.size}).on("end",r).start()};c(r)}}}]),angular.module("textAnalysis").controller("homeCtrl",["$scope","$anchorScroll","$location",function(e,t,n){e.scrollTo=function(e){n.hash(e),t()},e.showSideNav=function(){$(".button-collapse").sideNav({closeOnClick:!0})},e.userInput={timeline:"user"},e.loadTweets=function(){e.submitHandle.userInput.$valid&&n.path("/tweets/"+e.userInput.text).search({timeline:e.userInput.timeline})}}]),angular.module("textAnalysis").controller("tweetCtrl",["$routeParams","$scope","$log","$location","twitterService",function(e,t,n,a,r){t.loadingTweets=!0,t.timeline=r.timelineInput,t.loadResults=function(t,n){r.resultsTweet=t,a.path("/results/"+e.handle+"/"+n)},t.redirect=function(){a.url("/")},r.loadTweets(e.handle,e.timeline).then(function(a){if(n.log(a),!a.length||!a[0].user.hasOwnProperty("screen_name"))return void(t.invalidHandle=!0);t.twitterHandle=e.handle;var r=[];t.tweets=a,angular.forEach(t.tweets,function(e,t){r.push(e.text)});var i=r.join(""),s=i.replace(/@_&,+(?=\.)/g," ");t.words=s.match(/\S+/g),t.loadingTweets=!1}),t.correctTime=function(e){return new Date(Date.parse(e))}}]),angular.module("textAnalysis").controller("resultsCtrl",["$scope","$log","$routeParams","twitterService","aylienService",function(e,t,n,a,r){e.collapse=function(){$(".collapsible").collapsible({accordian:!1})},e.loadingSentiment=!0,e.loadingHashtags=!0,e.loadingEntities=!0,e.loadingClasses=!0,e.loadingConcepts=!0;var i=function(){e.words=function(){var e=a.resultsTweet.match(/\S+/g);return e}(),r.getSentiment(a.resultsTweet).then(function(t){e.sentiment=t,e.loadingSentiment=!1}),r.getHashtags(a.resultsTweet).then(function(t){e.hashtags=t.hashtags,e.loadingHashtags=!1}),r.getEntities(a.resultsTweet).then(function(t){e.entities=t.entities,e.loadingEntities=!1}),r.getClasses(a.resultsTweet).then(function(t){e.categories=t.categories,e.loadingClasses=!1}),r.getConcepts(a.resultsTweet).then(function(t){var n=Object.keys(t.concepts).length;1>n?null==e.concepts:e.concepts=t.concepts,e.loadingConcepts=!1})};a.resultsTweet.length?i():a.getSingleTweet(n.id).then(function(){i()})}]);