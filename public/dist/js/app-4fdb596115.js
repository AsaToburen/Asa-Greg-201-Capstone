"use strict";angular.module("d3").config(["$provide",function(e){var t=function(e){var t=e;return function(e){function n(){function e(e,t,r){for(var a,o,i,s=([{x:0,y:0},{x:n[0],y:n[1]}],t.x),l=t.y,u=Math.sqrt(n[0]*n[0]+n[1]*n[1]),f=C(n),h=Math.random()<.5?1:-1,g=-h;(a=f(g+=h))&&(o=~~a[0],i=~~a[1],!(Math.min(o,i)>u));)if(t.x=s+o,t.y=l+i,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>n[0]||t.y+t.y1>n[1]||r&&c(t,e,n[0])||r&&!d(t,r))){for(var m,y=t.sprite,v=t.width>>5,p=n[0]>>5,x=t.x-(v<<4),w=127&x,D=32-w,z=t.y1-t.y0,S=(t.y+t.y0)*p+(x>>5),T=0;z>T;T++){m=0;for(var M=0;v>=M;M++)e[S+M]|=m<<D|(v>M?(m=y[T*v+M])>>>w:0);S+=p}return delete t.sprite,!0}return!1}var n=[256,256],g=r,y=a,v=i,p=o,x=o,w=s,D=l,C=h,S=[],T=1/0,M=t.dispatch("word","end"),$=null,k={};return k.start=function(){function t(){for(var t,l=+new Date;+new Date-l<T&&++i<o&&$;)t=c[i],t.x=n[0]*(Math.random()+.5)>>1,t.y=n[1]*(Math.random()+.5)>>1,u(t,c,i),e(r,t,a)&&(s.push(t),M.word(t),a?f(a,t):a=[{x:t.x+t.x0,y:t.y+t.y0},{x:t.x+t.x1,y:t.y+t.y1}],t.x-=n[0]>>1,t.y-=n[1]>>1);i>=o&&(k.stop(),M.end(s,a))}var r=m((n[0]>>5)*n[1]),a=null,o=S.length,i=-1,s=[],c=S.map(function(e,t){return e.text=g.call(this,e,t),e.font=y.call(this,e,t),e.style=p.call(this,e,t),e.weight=x.call(this,e,t),e.rotate=w.call(this,e,t),e.size=~~v.call(this,e,t),e.padding=l.call(this,e,t),e}).sort(function(e,t){return t.size-e.size});return $&&clearInterval($),$=setInterval(t,0),t(),k},k.stop=function(){return $&&(clearInterval($),$=null),k},k.timeInterval=function(e){return arguments.length?(T=null==e?1/0:e,k):T},k.words=function(e){return arguments.length?(S=e,k):S},k.size=function(e){return arguments.length?(n=[+e[0],+e[1]],k):n},k.font=function(e){return arguments.length?(y=t.functor(e),k):y},k.fontStyle=function(e){return arguments.length?(p=t.functor(e),k):p},k.fontWeight=function(e){return arguments.length?(x=t.functor(e),k):x},k.rotate=function(e){return arguments.length?(w=t.functor(e),k):w},k.text=function(e){return arguments.length?(g=t.functor(e),k):g},k.spiral=function(e){return arguments.length?(C=z[e+""]||e,k):C},k.fontSize=function(e){return arguments.length?(v=t.functor(e),k):v},k.padding=function(e){return arguments.length?(D=t.functor(e),k):D},t.rebind(k,M,"on")}function r(e){return e.text}function a(){return"serif"}function o(){return"normal"}function i(e){return Math.sqrt(e.value)}function s(){return 30*(~~(6*Math.random())-3)}function l(){return 1}function u(e,t,n){if(!e.sprite){C.clearRect(0,0,(p<<5)/w,x/w);var r=0,a=0,o=0,i=t.length;for(n--;++n<i;){e=t[n],C.save(),C.font=e.style+" "+e.weight+" "+~~((e.size+1)/w)+"px "+e.font;var s=C.measureText(e.text+"m").width*w,l=e.size<<1;if(e.rotate){var u=Math.sin(e.rotate*v),c=Math.cos(e.rotate*v),f=s*c,d=s*u,h=l*c,g=l*u;s=Math.max(Math.abs(f+g),Math.abs(f-g))+31>>5<<5,l=~~Math.max(Math.abs(d+h),Math.abs(d-h))}else s=s+31>>5<<5;if(l>o&&(o=l),r+s>=p<<5&&(r=0,a+=o,o=0),a+l>=x)break;C.translate((r+(s>>1))/w,(a+(l>>1))/w),e.rotate&&C.rotate(e.rotate*v),C.fillText(e.text,0,0),C.restore(),e.width=s,e.height=l,e.xoff=r,e.yoff=a,e.x1=s>>1,e.y1=l>>1,e.x0=-e.x1,e.y0=-e.y1,r+=s}for(var m=C.getImageData(0,0,(p<<5)/w,x/w).data,y=[];--n>=0;){e=t[n];for(var s=e.width,D=s>>5,l=e.y1-e.y0,z=e.padding,S=0;l*D>S;S++)y[S]=0;if(r=e.xoff,null==r)return;a=e.yoff;for(var T=0,M=-1,$=0;l>$;$++){for(var S=0;s>S;S++){var k=D*$+(S>>5),b=m[(a+$)*(p<<5)+(r+S)<<2]?1<<31-S%32:0;z&&($&&(y[k-D]|=b),s-1>$&&(y[k+D]|=b),b|=b<<1|b>>1),y[k]|=b,T|=b}T?M=$:(e.y0++,l--,$--,a++)}e.y1=e.y0+M,e.sprite=y.slice(0,(e.y1-e.y0)*D)}}}function c(e,t,n){n>>=5;for(var r,a=e.sprite,o=e.width>>5,i=e.x-(o<<4),s=127&i,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*n+(i>>5),f=0;u>f;f++){r=0;for(var d=0;o>=d;d++)if((r<<l|(o>d?(r=a[f*o+d])>>>s:0))&t[c+d])return!0;c+=n}return!1}function f(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function d(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function h(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function g(e){var t=4,n=t*e[0]/e[1],r=0,a=0;return function(e){var o=0>e?-1:1;switch(Math.sqrt(1+4*o*e)-o&3){case 0:r+=n;break;case 1:a+=t;break;case 2:r-=n;break;default:a-=t}return[r,a]}}function m(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}var y,v=Math.PI/180,p=64,x=2048,w=1;if("undefined"!=typeof document)y=document.createElement("canvas"),y.width=1,y.height=1,w=Math.sqrt(y.getContext("2d").getImageData(0,0,1,1).data.length>>2),y.width=(p<<5)/w,y.height=x/w;else{var D=require("canvas");y=new D(p<<5,x)}var C=y.getContext("2d"),z={archimedean:h,rectangular:g};C.fillStyle="red",C.textAlign="center",e.cloud=n}("undefined"==typeof exports?t.layout||(t.layout={}):exports),t};e.decorator("d3",t)}]),angular.module("textAnalysis",["ngRoute","ngAnimate","d3"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"./components/home/home.view.html",controller:"homeCtrl"}).when("/tweets/:handle",{templateUrl:"./components/tweets/tweets.view.html",controller:"tweetCtrl"}).when("/results/:handle/:id",{templateUrl:"./components/results/results.view.html",controller:"resultsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("textAnalysis").factory("twitterService",["$q","$http","$log","$routeParams",function(e,t,n,r){var a={resultsTweet:"",userTimeline:{},checkCache:function(e,t){angular.isDefined(a.userTimeline[e+"-"+t])||(a.userTimeline[e+"-"+t]=[])},loadTweets:function(r,o){a.checkCache(r,o);var i=e.defer();return a.userTimeline[r+"-"+o].length>0?i.resolve(a.userTimeline[r+"-"+o]):(n.log("timelineInput :",o),t.get("/api/"+r,{params:{timeline:o}}).success(function(e){i.resolve(e),a.userTimeline[r+"-"+o]=e}).error(function(e){n.log("Error: ",e),i.reject(e)})),i.promise},getSingleTweet:function(r){var o=e.defer();return t.get("/api/results/"+r).success(function(e){o.resolve(e),a.resultsTweet=e.text}).error(function(e){n.log("Error: ",e),o.reject(e)}),o.promise}};return a}]),angular.module("textAnalysis").factory("aylienService",["$q","$http","$log","$routeParams",function(e,t,n,r){var a={analysisData:{},checkCache:function(e){angular.isDefined(a.analysisData[e])||(a.analysisData[e]={})},getSentiment:function(o){a.checkCache(r.handle);var i=encodeURIComponent(o),s=e.defer();return angular.isDefined(a.analysisData[r.handle].sentiment)?s.resolve(a.analysisData[r.handle].sentiment):t.get("/api/tweets/sentiment/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].sentiment=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getHashtags:function(o){a.checkCache(r.handle);var i=encodeURIComponent(o),s=e.defer();return angular.isDefined(a.analysisData[r.handle].hashtags)?s.resolve(a.analysisData[r.handle].hashtags):t.get("/api/tweets/hashtags/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].hashtags=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getEntities:function(o){a.checkCache(r.handle);var i=encodeURIComponent(o),s=e.defer();return angular.isDefined(a.analysisData[r.handle].entities)?s.resolve(a.analysisData[r.handle].entities):t.get("/api/tweets/entities/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].entities=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getClasses:function(o){a.checkCache(r.handle);var i=encodeURIComponent(o),s=e.defer();return angular.isDefined(a.analysisData[r.handle].classes)?s.resolve(a.analysisData[r.handle].classes):t.get("/api/tweets/classify/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].classes=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getConcepts:function(o){a.checkCache(r.handle);var i=encodeURIComponent(o),s=e.defer();return angular.isDefined(a.analysisData[r.handle].concepts)?s.resolve(a.analysisData[r.handle].concepts):t.get("/api/tweets/concepts/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].concepts=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise}};return a}]),angular.module("textAnalysis").directive("wordcloud",["d3",function(e){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(t,n,r){var a,o=1370,i=1e3,s="Roboto",l=100;if(angular.isDefined(r.width)&&(o=r.width),angular.isDefined(r.height)&&(i=r.height),angular.isDefined(r.fontFamily)&&(s=r.fontFamily),angular.isDefined(r.fontSize)&&(l=1*r.fontSize||0),angular.isDefined(t.words)&&(a=t.words),angular.isDefined(t.words)&&angular.isArray(a))a=t.words;else if(angular.element(n).find("word").length>0){var u=angular.element(n).find("word");a=[],angular.forEach(u,function(e){a.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(n.text().length>0))return void n.text("wordcloud: Please define some words");a=n.text().split(","),n.text("")}if(!angular.isNumber(l)||0>=l)return void n.text("wordcloud: font-size attribute not valid. font-size "+r.fontSize+" -> "+l);var c=function(r){function a(r){var a=i/2,l=o/2,c=n[0];e.select(c).append("svg").attr("width",o).attr("height",i).append("g").attr("transform","translate("+l+","+a+")").selectAll("text").data(r).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",s).style("fill",function(e,t){return u(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){t.onClick({element:e})}).on("mouseover",function(e){t.onHover({element:e})})}var u=e.scale.category20();e.layout.cloud().size([o,i]).words(r.map(function(e){return{text:e,size:Math.random()*l}})).rotate(function(){return-90*~~(2*Math.random())}).font(s).fontSize(function(e){return e.size}).on("end",a).start()};c(a)}}}]),angular.module("textAnalysis").directive("resultsCloud",["d3",function(e){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(t,n,r){var a,o=400,i=900,s="Roboto",l=200;if(angular.isDefined(r.width)&&(i=r.width),angular.isDefined(r.height)&&(o=r.height),angular.isDefined(r.fontFamily)&&(s=r.fontFamily),angular.isDefined(r.fontSize)&&(l=1*r.fontSize||0),angular.isDefined(t.words)&&(a=t.words),angular.isDefined(t.words)&&angular.isArray(a))a=t.words;else if(angular.element(n).find("word").length>0){var u=angular.element(n).find("word");a=[],angular.forEach(u,function(e){a.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(n.text().length>0))return void n.text("wordcloud: Please define some words");a=n.text().split(","),n.text("")}if(!angular.isNumber(l)||0>=l)return void n.text("wordcloud: font-size attribute not valid. font-size "+r.fontSize+" -> "+l);var c=function(r){function a(r){var a=o/2,l=i/2,c=n[0];e.select(c).append("svg").attr("width",i).attr("height",o).append("g").attr("transform","translate("+l+","+a+")").selectAll("text").data(r).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",s).style("fill",function(e,t){return u(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){t.onClick({element:e})}).on("mouseover",function(e){t.onHover({element:e})})}var u=e.scale.category20();e.layout.cloud().size([i,o]).words(r.map(function(e){return{text:e,size:Math.random()*l}})).rotate(function(){return-90*~~(2*Math.random())}).font(s).fontSize(function(e){return e.size}).on("end",a).start()};c(a)}}}]),angular.module("textAnalysis").controller("homeCtrl",["$scope","$anchorScroll","$location",function(e,t,n){e.scrollTo=function(e){n.hash(e),t()},e.showSideNav=function(){$(".button-collapse").sideNav({closeOnClick:!0})},e.userInput={timeline:"user"},e.loadTweets=function(){e.submitHandle.userInput.$valid&&n.path("/tweets/"+e.userInput.text).search({timeline:e.userInput.timeline})}}]),angular.module("textAnalysis").controller("tweetCtrl",["$routeParams","$scope","$log","$location","twitterService",function(e,t,n,r,a){t.loadingTweets=!0,t.timeline=a.timelineInput,t.loadResults=function(t,n){a.resultsTweet=t,r.path("/results/"+e.handle+"/"+n)},t.redirect=function(){r.url("/")},a.loadTweets(e.handle,e.timeline).then(function(r){if(n.log(r),!r.length||!r[0].user.hasOwnProperty("screen_name"))return void(t.invalidHandle=!0);t.twitterHandle=e.handle;var a=[];t.tweets=r,angular.forEach(t.tweets,function(e,t){a.push(e.text)});var o=a.join(""),i=o.replace(/@_&,+(?=\.)/g," ");t.words=i.match(/\S+/g),t.loadingTweets=!1}),t.correctTime=function(e){return new Date(Date.parse(e))}}]),angular.module("textAnalysis").controller("resultsCtrl",["$scope","$log","$routeParams","twitterService","aylienService",function(e,t,n,r,a){e.collapse=function(){$(".collapsible").collapsible({accordian:!1})},e.loadingSentiment=!0,e.loadingHashtags=!0,e.loadingEntities=!0,e.loadingClasses=!0,e.loadingConcepts=!0;var o=function(){e.words=function(){var e=r.resultsTweet.match(/\S+/g);return e}(),a.getSentiment(r.resultsTweet).then(function(t){e.sentiment=t,e.loadingSentiment=!1}),a.getHashtags(r.resultsTweet).then(function(t){e.hashtags=t.hashtags,e.loadingHashtags=!1}),a.getEntities(r.resultsTweet).then(function(t){e.entities=t.entities,e.loadingEntities=!1}),a.getClasses(r.resultsTweet).then(function(t){e.categories=t.categories,e.loadingClasses=!1}),a.getConcepts(r.resultsTweet).then(function(t){var n=Object.keys(t.concepts).length;1>n?null==e.concepts:e.concepts=t.concepts,e.loadingConcepts=!1})};r.resultsTweet.length?o():r.getSingleTweet(n.id).then(function(){o()})}]);